<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome file</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="mpi---forest-fire-simulation">MPI - Forest-fire simulation</h1>
<p>Il <strong>forest-fire model</strong> è stato creato utilizzando MPI durante il corso di <em>PROGRAMMAZIONE CONCORRENTE PARALLELA E SU CLOUD</em> all’università degli studi di Salerno</p>
<h2 id="indice">Indice</h2>
<ul>
<li><a href="#introduzione">Introduzione</a></li>
<li><a href="#breve-descrizione-della-soluzione">Breve descrizione della soluzione</a></li>
<li><a href="#istruzioni-per-lesecuzione">Istruzioni per l’esecuzione</a></li>
<li><a href="#dettagli-di-implementazione">Dettagli di implementazione</a></li>
<li><a href="#prova-della-correttezza">Prova della correttezza</a></li>
<li><a href="#benchmarks">Benchmarks</a></li>
</ul>
<h2 id="introduzione">Introduzione</h2>
<p>Il modello è definito come un automa cellulare su una griglia NxM. Una cella può essere vuota, occupata da un albero, da un seme di albero, o in fiamme. Il modello è definito dalle seguenti sei regole che vengono eseguite contemporaneamente:</p>
<ol>
<li>Una cella in fiamme si trasforma in una cella vuota;</li>
<li>Un albero brucerà se almeno un vicino sta bruciando;</li>
<li>Un seme di albero si trasforma in un albero;</li>
<li>Un albero si accende con probabilità <em>f=1%</em> anche se nessun vicino sta bruciando;</li>
<li>Uno spazio vuoto si accende con probabilità <em>f</em>;</li>
<li>Uno spazio vuoto si riempie di un seme d’albero con probabilità <em>p=6%</em>;</li>
</ol>
<p>Lo stato di una cella può essere:</p>

<table>
<thead>
<tr>
<th>Emoji</th>
<th>ASCII</th>
<th>Stato</th>
</tr>
</thead>
<tbody>
<tr>
<td>🌳</td>
<td>T</td>
<td>Albero</td>
</tr>
<tr>
<td>🌱</td>
<td>i</td>
<td>Seme albero</td>
</tr>
<tr>
<td></td>
<td>-</td>
<td>Vuoto</td>
</tr>
<tr>
<td>🔥</td>
<td>*</td>
<td>Fuoco</td>
</tr>
</tbody>
</table><p>La simulazione è eseguita un numero fissato di volte. Ad ogni fase di simulazione, i processori eseguono le 5 regole precedentemente descritte, e comunicano con i processori vicini per completare il calcolo.</p>
<h2 id="breve-descrizione-della-soluzione">Breve descrizione della soluzione</h2>
<p>Il codice prende in input dall’utente:</p>
<ol>
<li>Se eseguire le stampe;</li>
<li>la grandezza della matrice;</li>
</ol>
<p>Tutti i <strong>processori</strong> generano una porzione di matrice in base alla taglia che gli è stata assegnata, successivamente continuano la propria simulazione indipendentemente, fino a quando, se necessario completeranno il calcolo chiedendo ai worker vicini i dati necessari altrimenti no. Una volta terminata la simulazione sui singoli <strong>workers</strong>, se è stato chiesto di stampare l’andamento della simulazione, il processore <strong>con rank 0</strong> stampa a video lo stato di essa.</p>
<h2 id="istruzioni-per-lesecuzione">Istruzioni per l’esecuzione</h2>
<h3 id="pre-requisiti">Pre-requisiti</h3>
<ul>
<li>Ubuntu 18.04 LTS (<em>min: 10 GB storage</em>);</li>
<li>Set-up dell’ambiente seguendo<code>https://github.com/spagnuolocarmine/ubuntu-openmpi-openmp</code>;</li>
</ul>
<h3 id="esecuzione-locale">Esecuzione locale</h3>
<ul>
<li>Avere nella stella directory i file:<code>mycollection.h</code> e <code>forest-fire.c</code>;</li>
<li>Eseguire il comando <code>mpicc forest-fire.c -o forest</code> per la compilazione;</li>
<li>Eseguire <code>mpirun --allow-run-as-root -np 4 forest</code> (4 è un numero di processori indicativo, si può assegnare il valore più consono alla propria macchina).</li>
</ul>
<h3 id="esecuzione-distribuita">Esecuzione distribuita</h3>
<ul>
<li>Avere <em>n</em> macchine che condividono lo stesso <a href="#pre-requisiti">set-up</a> stabilito nei pre-requisiti;</li>
<li>Ogni macchina deve avere nella stessa directory <code>hfile</code>, <code>mycollection.h</code> e <code>forest-fire.c</code>;</li>
<li>Eseguire il comando <code>mpicc forest-fire.c -o forest</code>per la compilazione;</li>
<li>Eseguire sulla macchina <strong>master</strong> <code>mpirun --allow-run-as-root -np 2 --hostfile hfile ./forest</code>.</li>
</ul>
<h3 id="run-time">Run-time</h3>
<p>Allo start-up del programma viene chiesto all’utente la modalità di stampa (Eseguire la &lt;print-mode&gt; influisce molto negativamente sulle performance dovuto a 2 cause: <em>printf()</em> e <em>MPI_Gatherv()</em> )</p>
<ul>
<li>0 la soluzione viene mostrata con i caratteri ASCII;</li>
<li>1 la soluzione viene mostrata con le emoji;</li>
<li>2 la soluzione viene mostrata in una modalità <em>“debug”</em> mostrando visivamente dove comunicano i processori tra loro.</li>
</ul>
<p><img src="https://i.imgur.com/JLG5EW6.png?1" alt=""><br>
Successivamente viene chiesta la grandezza della matrice sul quale si andrà a lavorare.<br>
<img src="https://i.imgur.com/hcGC7NY.png" alt=""><br>
Infine si otterrà l’esecuzione desiderata con le relative stampe.</p>
<h2 id="dettagli-di-implementazione">Dettagli di implementazione</h2>
<p>Il codice main <code>forest-fire.c</code> è il seguente:</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token comment">/**
* ░▒█▀▀▀░▄▀▀▄░█▀▀▄░█▀▀░█▀▀░▀█▀░░░░█▀▀░░▀░░█▀▀▄░█▀▀░░░▒█▀▀▀█░░▀░░█▀▄▀█░█░▒█░█░░█▀▀▄░▀█▀░░▀░░▄▀▀▄░█▀▀▄
* ░▒█▀▀░░█░░█░█▄▄▀░█▀▀░▀▀▄░░█░░▀▀░█▀░░░█▀░█▄▄▀░█▀▀░░░░▀▀▀▄▄░░█▀░█░▀░█░█░▒█░█░░█▄▄█░░█░░░█▀░█░░█░█░▒█
* ░▒█░░░░░▀▀░░▀░▀▀░▀▀▀░▀▀▀░░▀░░░░░▀░░░▀▀▀░▀░▀▀░▀▀▀░░░▒█▄▄▄█░▀▀▀░▀░░▒▀░░▀▀▀░▀▀░▀░░▀░░▀░░▀▀▀░░▀▀░░▀░░▀
*          _                     ___                
* |_ \/   |_| _ _|_ _  _  . _     _/ . _  _  _   _ .
* |_)/    | || | |_(_)| | |(_)   /__ | /_ /_(_| |  |
* 
* @author Antonio Zizzari
* @date 08/04/2022
* @brief MPI Forest-Fire Simulation 
* @details Il modello è definito come un automa cellulare su una griglia NxN. Una cella può essere vuota,
* occupata da un albero, da un seme di albero, o in fiamme. Il modello è definito dalle seguenti cinque regole 
* che vengono eseguite contemporaneamente:
*     1. Una cella in fiamme si trasforma in una cella vuota;
*     2. Un albero brucerà se almeno un vicino sta bruciando;
*     3. Un seme di albero si trasforma in un albero;
*     4. Un albero si accende con probabilità f=1% anche se nessun vicino sta bruciando;
*     5. Uno spazio vuoto si riempie di un seme d’albero con probabilità p=6%;
* Lo stato di una cella può essere:
*   T (Albero)
*   i (Seme albero)
*   - (vuoto)
*   * (fuoco)
* Materiali usati:
*   Graphics: https://textfancy.com/multiline-text-art/
*   Documentation: 
*       https://www.mpich.org/static/docs/v3.2/
*       https://www.math.tu-cottbus.de/~kd/parallel/mpi/mpi-course.book_2.html
*       https://www.rookiehpc.com/mpi/docs/index.php
*   Course materials: https://tech.io/playgrounds/47058/have-fun-with-mpi-in-c/lets-start-to-have-fun-with-mpi
*
*
*
**/</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"mpi.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"mycollective.h"</span> </span><span class="token comment">//Libreria con tutte le funzioni essenziali</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*Dichiarazione variabili iniziali*/</span>
    <span class="token keyword">int</span> myrank<span class="token punctuation">,</span>numtasks<span class="token punctuation">;</span>
    <span class="token keyword">int</span> split<span class="token punctuation">,</span>plus_i<span class="token punctuation">,</span>N<span class="token punctuation">,</span>M<span class="token punctuation">,</span>style<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>print_mode<span class="token punctuation">;</span>
    bool send<span class="token operator">=</span>false<span class="token punctuation">;</span>
    
    <span class="token comment">/*Probabilità della simulazione*/</span>
    <span class="token keyword">int</span> prob_generate_tree<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> prob_generate_fire<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> prob_generate_seed<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">;</span>

    <span class="token comment">/*Variabili tempo per speed-up*/</span>
    <span class="token keyword">double</span> start<span class="token punctuation">,</span> end<span class="token punctuation">;</span>
    
    <span class="token comment">/*Codice MPI essenziale*/</span>
    <span class="token function">MPI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MPI_Comm_rank</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>myrank<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MPI_Comm_size</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>numtasks<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Nel caso ci interessasse la non esecuzione sequenziale</span>
    <span class="token comment">/* 
    if(numtasks==1){
        fprintf( stderr, "Numero processori non valido!!!\n");
        MPI_Abort(MPI_COMM_WORLD,1);
    }
    */</span>

    <span class="token comment">//CODICE PER MOSTRARE CHE OLTRE I 16.000.000 ELEMENTI CRASHA IL CODICE</span>
    <span class="token comment">//char test[16000001];</span>
    <span class="token comment">//test[16000000]='1';</span>

    <span class="token comment">/*Prendo in inut le variabili essenziali*/</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>myrank <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">print_menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Wanna run the &lt;print-mode&gt; (type 0 'NO', or 1 'YES')?:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>print_mode<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">if</span><span class="token punctuation">(</span>print_mode<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Choose the program style (avialbe: 0, 1, 2):\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Give the matrix size (NxM), give N:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Give the matrix size (NxM), give M:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              
    <span class="token punctuation">}</span>

    start <span class="token operator">=</span> <span class="token function">MPI_Wtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*Inizio a segnare il tempo*/</span>

    <span class="token comment">/*Seed del numero random*/</span>
    <span class="token function">srand</span><span class="token punctuation">(</span><span class="token punctuation">(</span>myrank<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*Broadcast delle variabili essenziali*/</span>
    <span class="token function">MPI_Bcast</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>N<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MPI_Bcast</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>M<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MPI_Bcast</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>style<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MPI_Bcast</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>print_mode<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*Calcolo come suddividere il carico tra i processori.*/</span>
    <span class="token function">split_domain</span><span class="token punctuation">(</span>numtasks<span class="token punctuation">,</span>N<span class="token punctuation">,</span><span class="token operator">&amp;</span>split<span class="token punctuation">,</span><span class="token operator">&amp;</span>plus_i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> rank_split<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>myrank<span class="token operator">&lt;</span>plus_i<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>split<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>split<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*Generazione della foresta delegata al rank 0*/</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>splitted_forest<span class="token operator">=</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rank_split<span class="token operator">*</span>M<span class="token punctuation">)</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//char splitted_forest[rank_split*M];</span>
    

    <span class="token comment">/*Popolo il bosco*/</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rank_split<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">&lt;=</span>prob_generate_tree<span class="token punctuation">)</span><span class="token comment">/* Probabilità che nasca un albero */</span>
                splitted_forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'T'</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                splitted_forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/***FORMATTO SCATTERV E GATHER***/</span>
    <span class="token keyword">int</span> send_counts<span class="token punctuation">[</span>numtasks<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> send_displacements<span class="token punctuation">[</span>numtasks<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>print_mode<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//char forest[N*M];</span>
        <span class="token keyword">char</span> <span class="token operator">*</span>forest<span class="token operator">=</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>N<span class="token operator">*</span>M<span class="token punctuation">)</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">/*Porzione di array che riceverò dalla scatterv*/</span>
        <span class="token comment">/*da quanti elementi è formato l'array che devo mandare ad ogni processore*/</span>        
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>numtasks<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> send_counts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token operator">&lt;</span>plus_i<span class="token punctuation">)</span> <span class="token operator">?</span> M<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> M<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*da quale index parto ad ogni processore*/</span>        
        send_displacements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>numtasks<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
            send_displacements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token operator">&lt;=</span>plus_i<span class="token punctuation">)</span> <span class="token operator">?</span> send_displacements<span class="token punctuation">[</span>i<span class="token number">-1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span>M<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> send_displacements<span class="token punctuation">[</span>i<span class="token number">-1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span>M<span class="token operator">*</span>split<span class="token punctuation">)</span><span class="token punctuation">;</span>

        
        <span class="token comment">/*Ricevo i dati per stamparli*/</span>
        <span class="token function">MPI_Gatherv</span><span class="token punctuation">(</span>splitted_forest<span class="token punctuation">,</span> <span class="token punctuation">(</span>myrank<span class="token operator">&lt;</span>plus_i<span class="token punctuation">)</span> <span class="token operator">?</span> M<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> M<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token punctuation">)</span><span class="token comment">/*Quanti elementi invio*/</span><span class="token punctuation">,</span> MPI_CHAR<span class="token punctuation">,</span> forest<span class="token punctuation">,</span> send_counts<span class="token punctuation">,</span> send_displacements<span class="token punctuation">,</span> MPI_CHAR<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*Stampo la foresta al Day 0*/</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>myrank<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Day 0\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_forest</span><span class="token punctuation">(</span>forest<span class="token punctuation">,</span>N<span class="token punctuation">,</span>M<span class="token punctuation">,</span>style<span class="token punctuation">,</span>split<span class="token punctuation">,</span>plus_i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token function">free</span><span class="token punctuation">(</span>forest<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*Libero spazio*/</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*Variabili essenziali per il while*/</span>
    <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//char temp_forest[rank_split*M];</span><span class="token comment">/*array della tecnica double buffer che conterrà i risultati*/</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>temp_forest<span class="token operator">=</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rank_split<span class="token operator">*</span>M<span class="token punctuation">)</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token comment">/*array della tecnica double buffer che conterrà i risultati*/</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>   
        <span class="token comment">//MPI_Scatterv(forest, send_counts, send_displacements, MPI_CHAR, splitted_forest , (myrank&lt;plus_i) ? M*(split+1) : M*(split)</span><span class="token comment">/*Quanti elementi ricevo*/</span><span class="token punctuation">,</span> MPI_CHAR<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token operator">/</span><span class="token comment">/****CODICE SIMULAZIONE
        //Variabili essenziali
        MPI_Request request_send1=MPI_REQUEST_NULL,request_recv1=MPI_REQUEST_NULL,request_send2=MPI_REQUEST_NULL,request_recv2=MPI_REQUEST_NULL;  
        MPI_Status status1,status2,status3,status4;        
        memset(temp_forest,'-',rank_split*M);/*Setto tutti i valori di temp_forest a "-" */</span>
        <span class="token keyword">int</span> count1<span class="token punctuation">,</span>count2<span class="token punctuation">;</span>
        
        <span class="token comment">//int bot_send[M],bot_recv[M];</span>
        <span class="token comment">//int top_send[M],top_recv[M];</span>

        <span class="token keyword">int</span> <span class="token operator">*</span>bot_send<span class="token operator">=</span><span class="token function">malloc</span><span class="token punctuation">(</span>M<span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> <span class="token operator">*</span>bot_recv<span class="token operator">=</span><span class="token function">malloc</span><span class="token punctuation">(</span>M<span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> <span class="token operator">*</span>top_send<span class="token operator">=</span><span class="token function">malloc</span><span class="token punctuation">(</span>M<span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> <span class="token operator">*</span>top_recv<span class="token operator">=</span><span class="token function">malloc</span><span class="token punctuation">(</span>M<span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>myrank<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//int bot_send[M],bot_recv[M];</span>
            <span class="token comment">//int top_send[M];</span><span class="token comment">/*non ci serve per il calcolo*/</span>
            
            <span class="token keyword">int</span> top<span class="token punctuation">,</span>bot<span class="token punctuation">;</span>
            

            <span class="token keyword">if</span><span class="token punctuation">(</span>numtasks<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">/*Esecuzione parallela*/</span>
                <span class="token comment">/*Aspetto edge da rank 1 */</span>
                <span class="token function">MPI_Irecv</span><span class="token punctuation">(</span>bot_recv<span class="token punctuation">,</span> M<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>request_recv1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">/*Il fuoco si propaga e ritorno se ci sono ai bordi dei fuochi*/</span>
                <span class="token function">fire_run_return_set</span><span class="token punctuation">(</span>splitted_forest<span class="token punctuation">,</span>temp_forest<span class="token punctuation">,</span>rank_split<span class="token punctuation">,</span>M<span class="token punctuation">,</span>top_send<span class="token punctuation">,</span>bot_send<span class="token punctuation">,</span><span class="token operator">&amp;</span>top<span class="token punctuation">,</span><span class="token operator">&amp;</span>bot<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token function">MPI_Isend</span><span class="token punctuation">(</span>bot_send<span class="token punctuation">,</span> bot<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>request_send1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*Mando array a rank 1*/</span>
              

                
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">/*Esecuzione sequenziale*/</span>
                <span class="token function">fire_run</span><span class="token punctuation">(</span>splitted_forest<span class="token punctuation">,</span>temp_forest<span class="token punctuation">,</span>rank_split<span class="token punctuation">,</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*Il fuoco si propaga*/</span>
            <span class="token punctuation">}</span>
                

            <span class="token keyword">if</span><span class="token punctuation">(</span>numtasks<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">/*Esecuzione parallela*/</span>
                <span class="token function">MPI_Wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>request_send1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">MPI_Wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>request_recv1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token function">MPI_Get_count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>status2<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>count1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>count1<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token function">fire_run_bot_edge_pointer</span><span class="token punctuation">(</span>bot_recv<span class="token punctuation">,</span>count1<span class="token punctuation">,</span>temp_forest<span class="token punctuation">,</span>M<span class="token punctuation">,</span>rank_split<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*fuoco sul bordo*/</span>


            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">/*Esecuzione sequenziale*/</span>
                <span class="token punctuation">;</span>
            <span class="token punctuation">}</span>            

            <span class="token function">forest_run</span><span class="token punctuation">(</span>rank_split<span class="token punctuation">,</span>M<span class="token punctuation">,</span>temp_forest<span class="token punctuation">,</span>prob_generate_fire<span class="token punctuation">,</span>prob_generate_seed<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*si accende il fuoco &amp; nasce un seed &amp; cresce un albero*/</span>

            
            
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>myrank<span class="token operator">==</span>numtasks<span class="token number">-1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">int</span> top<span class="token punctuation">,</span>bot<span class="token punctuation">;</span>        

            <span class="token function">MPI_Irecv</span><span class="token punctuation">(</span>top_recv<span class="token punctuation">,</span> M<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> myrank<span class="token number">-1</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>request_recv1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">fire_run_return_set</span><span class="token punctuation">(</span>splitted_forest<span class="token punctuation">,</span>temp_forest<span class="token punctuation">,</span>rank_split<span class="token punctuation">,</span>M<span class="token punctuation">,</span>top_send<span class="token punctuation">,</span>bot_send<span class="token punctuation">,</span><span class="token operator">&amp;</span>top<span class="token punctuation">,</span><span class="token operator">&amp;</span>bot<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*Il fuoco si propaga*/</span>
            
            <span class="token function">MPI_Isend</span><span class="token punctuation">(</span>top_send<span class="token punctuation">,</span> top<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> myrank<span class="token number">-1</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>request_send1<span class="token punctuation">)</span><span class="token punctuation">;</span>

            
            <span class="token function">MPI_Wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>request_send1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">MPI_Wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>request_recv1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            
            <span class="token function">MPI_Get_count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>status2<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>count2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>count2<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token function">fire_run_top_edge_pointer</span><span class="token punctuation">(</span>top_recv<span class="token punctuation">,</span>count2<span class="token punctuation">,</span>temp_forest<span class="token punctuation">,</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>            

            <span class="token function">forest_run</span><span class="token punctuation">(</span>rank_split<span class="token punctuation">,</span>M<span class="token punctuation">,</span>temp_forest<span class="token punctuation">,</span>prob_generate_fire<span class="token punctuation">,</span>prob_generate_seed<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            
            <span class="token keyword">int</span> top<span class="token punctuation">,</span>bot<span class="token punctuation">;</span>

            <span class="token function">MPI_Irecv</span><span class="token punctuation">(</span>bot_recv<span class="token punctuation">,</span> M<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> myrank<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>request_recv2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*recv bot from top*/</span>
            <span class="token function">MPI_Irecv</span><span class="token punctuation">(</span>top_recv<span class="token punctuation">,</span> M<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> myrank<span class="token number">-1</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>request_recv1<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">fire_run_return_set</span><span class="token punctuation">(</span>splitted_forest<span class="token punctuation">,</span>temp_forest<span class="token punctuation">,</span>rank_split<span class="token punctuation">,</span>M<span class="token punctuation">,</span>top_send<span class="token punctuation">,</span>bot_send<span class="token punctuation">,</span><span class="token operator">&amp;</span>top<span class="token punctuation">,</span><span class="token operator">&amp;</span>bot<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*Il fuoco si propaga*/</span>
            <span class="token comment">/*send dell'array top &amp; bot*/</span>
            <span class="token function">MPI_Isend</span><span class="token punctuation">(</span>top_send<span class="token punctuation">,</span> top<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> myrank<span class="token number">-1</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>request_send1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*send top to bot^*/</span>     
            <span class="token function">MPI_Isend</span><span class="token punctuation">(</span>bot_send<span class="token punctuation">,</span> bot<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> myrank<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>request_send2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            
            <span class="token function">MPI_Wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>request_send1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">MPI_Wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>request_recv2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status2<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">MPI_Get_count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>status2<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>count1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>count1<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token function">fire_run_bot_edge_pointer</span><span class="token punctuation">(</span>bot_recv<span class="token punctuation">,</span>count1<span class="token punctuation">,</span>temp_forest<span class="token punctuation">,</span>M<span class="token punctuation">,</span>rank_split<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">MPI_Wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>request_send2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status3<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">MPI_Wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>request_recv1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status4<span class="token punctuation">)</span><span class="token punctuation">;</span> 

            <span class="token function">MPI_Get_count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>status4<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>count2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>count2<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token function">fire_run_top_edge_pointer</span><span class="token punctuation">(</span>top_recv<span class="token punctuation">,</span>count2<span class="token punctuation">,</span>temp_forest<span class="token punctuation">,</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>            

            <span class="token function">forest_run</span><span class="token punctuation">(</span>rank_split<span class="token punctuation">,</span>M<span class="token punctuation">,</span>temp_forest<span class="token punctuation">,</span>prob_generate_fire<span class="token punctuation">,</span>prob_generate_seed<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>    
        
        <span class="token keyword">if</span><span class="token punctuation">(</span>print_mode<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//char forest[N*M];</span>
            <span class="token keyword">char</span> <span class="token operator">*</span>forest<span class="token operator">=</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>N<span class="token operator">*</span>M<span class="token punctuation">)</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/*Ricevo i dati per stamparli*/</span>
            <span class="token function">MPI_Gatherv</span><span class="token punctuation">(</span>temp_forest<span class="token punctuation">,</span> <span class="token punctuation">(</span>myrank<span class="token operator">&lt;</span>plus_i<span class="token punctuation">)</span> <span class="token operator">?</span> M<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> M<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token punctuation">)</span><span class="token comment">/*Quanti elementi invio*/</span><span class="token punctuation">,</span> MPI_CHAR<span class="token punctuation">,</span> forest<span class="token punctuation">,</span> send_counts<span class="token punctuation">,</span> send_displacements<span class="token punctuation">,</span> MPI_CHAR<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>myrank<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Day %d\n"</span><span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_forest</span><span class="token punctuation">(</span>forest<span class="token punctuation">,</span>N<span class="token punctuation">,</span>M<span class="token punctuation">,</span>style<span class="token punctuation">,</span>split<span class="token punctuation">,</span>plus_i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">free</span><span class="token punctuation">(</span>forest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/****************************/</span>
        <span class="token function">strcpy</span><span class="token punctuation">(</span>splitted_forest<span class="token punctuation">,</span>temp_forest<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*aggiorno i dati sull'array*/</span>

        <span class="token function">free</span><span class="token punctuation">(</span>bot_send<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">free</span><span class="token punctuation">(</span>bot_recv<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">free</span><span class="token punctuation">(</span>top_send<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">free</span><span class="token punctuation">(</span>top_recv<span class="token punctuation">)</span><span class="token punctuation">;</span>

        i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&gt;</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

        
    <span class="token punctuation">}</span>
    
    <span class="token comment">/*Fine codice*/</span>
    <span class="token function">MPI_Barrier</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    end <span class="token operator">=</span> <span class="token function">MPI_Wtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">free</span><span class="token punctuation">(</span>splitted_forest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>temp_forest<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">MPI_Finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>myrank <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* Master node scrive su stdout il tempo*/</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Time in ms = %f\n"</span><span class="token punctuation">,</span> end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>esso fa affidamento ad una libreria <code>mycollective.h</code> scritta da me per l’esecuzione di funzioni che è la seguente :</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token comment">/********************************************************************
UTILS
*********************************************************************/</span>
<span class="token comment">//Suddivisione dominio per righe</span>
<span class="token keyword">void</span> <span class="token function">split_domain</span><span class="token punctuation">(</span><span class="token keyword">int</span> num_p<span class="token punctuation">,</span><span class="token keyword">int</span> domain<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>split<span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">*</span>plus_i<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>num_p<span class="token operator">&gt;</span>domain<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"N matrice non compatibile con numero processori\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">MPI_Abort</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">*</span>split <span class="token operator">=</span> domain<span class="token operator">/</span>num_p<span class="token punctuation">;</span>
    <span class="token operator">*</span>plus_i <span class="token operator">=</span>  domain<span class="token operator">%</span>num_p<span class="token punctuation">;</span><span class="token comment">//Numero di elementi che avranno un +1 sulla riga</span>
<span class="token punctuation">}</span>

<span class="token comment">//Funzione che applica il fuoco sulla foresta e lo fa runnare</span>
<span class="token keyword">void</span> <span class="token function">fire_run</span><span class="token punctuation">(</span><span class="token keyword">char</span> forest0<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">char</span> forest1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> row<span class="token punctuation">,</span><span class="token keyword">int</span> col<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>row<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>col<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>forest0<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">case</span> <span class="token string">'T'</span><span class="token punctuation">:</span><span class="token comment">/*Se questo albero è stato bruciato da un vicino lo rimango tale altrimenti no*/</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'*'</span><span class="token punctuation">)</span>
                            <span class="token punctuation">;</span>
                        <span class="token keyword">else</span>
                            forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'T'</span><span class="token punctuation">;</span>
                            
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token keyword">case</span> <span class="token string">'*'</span><span class="token punctuation">:</span>  
                        <span class="token comment">/* [x][y]*/</span>                      
                        <span class="token comment">/*[-1][-1] [-1][0] [-1][+1] [0][-1] [0][0] [0][+1] [+1][-1] [+1][0] [+1][+1]*/</span>
                        forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">;</span><span class="token comment">/*Spengo il fuoco che ha bruciato i dintorni*/</span>
                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> x <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">/*Brucio nei dintorni gli alberi*/</span>
                        <span class="token punctuation">{</span>
                            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> y <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span>
                            <span class="token punctuation">{</span>
                                <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&lt;</span>row<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token operator">&lt;</span>col<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                                    <span class="token keyword">if</span><span class="token punctuation">(</span>forest0<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> col <span class="token operator">+</span> <span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'T'</span><span class="token punctuation">)</span><span class="token comment">/*Gli alberi prendono fuoco*/</span>
                                        forest1<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> col <span class="token operator">+</span> <span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token string">'i'</span><span class="token punctuation">:</span>
                        forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'i'</span><span class="token punctuation">;</span><span class="token comment">/*La natura vince sugli umani che sono malvagi e un seed sopravvive sempre
                        break;*/</span>
                    <span class="token keyword">case</span> <span class="token string">'-'</span><span class="token punctuation">:</span>
                        forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">;</span><span class="token comment">/*Vuoto ero e vuoto rimango*/</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">//Accendo il fuoco sul bordo superiore</span>
<span class="token keyword">void</span> <span class="token function">fire_run_top_edge</span><span class="token punctuation">(</span><span class="token keyword">char</span> from<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">char</span> to<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> N<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>N<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'*'</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>x<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>x<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&lt;</span>N<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">[</span>i<span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'T'</span><span class="token punctuation">)</span><span class="token comment">/*Gli alberi prendono fuoco*/</span>
                        to<span class="token punctuation">[</span>i<span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//Accendo il fuoco sul bordo inferiore</span>
<span class="token keyword">void</span> <span class="token function">fire_run_bot_edge</span><span class="token punctuation">(</span><span class="token keyword">char</span> from<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">char</span> to<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> N<span class="token punctuation">,</span><span class="token keyword">int</span> split<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>N<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'*'</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>x<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>x<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">+</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token punctuation">(</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">+</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&lt;</span>N<span class="token operator">*</span>split<span class="token punctuation">)</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">[</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">+</span>i<span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'T'</span><span class="token punctuation">)</span><span class="token comment">/*Gli alberi prendono fuoco*/</span>
                        to<span class="token punctuation">[</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">+</span>i<span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//si accende il fuoco &amp; nasce un seed &amp; cresce un albero</span>
<span class="token keyword">void</span> <span class="token function">forest_run</span><span class="token punctuation">(</span><span class="token keyword">int</span> rank_split<span class="token punctuation">,</span><span class="token keyword">int</span> N<span class="token punctuation">,</span><span class="token keyword">char</span> forest<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> prob_generate_fire<span class="token punctuation">,</span><span class="token keyword">int</span> prob_generate_seed<span class="token punctuation">)</span><span class="token punctuation">{</span>
    
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rank_split<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>forest<span class="token punctuation">[</span>i <span class="token operator">*</span> N <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token string">'T'</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">&lt;=</span>prob_generate_fire<span class="token punctuation">)</span><span class="token comment">/* Probabilità che un albero prenda fuoco */</span>
                        forest<span class="token punctuation">[</span>i <span class="token operator">*</span> N <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">'i'</span><span class="token punctuation">:</span>
                    forest<span class="token punctuation">[</span>i <span class="token operator">*</span> N <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'T'</span><span class="token punctuation">;</span> <span class="token comment">/* L'albero cresce*/</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">'-'</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">&lt;=</span>prob_generate_fire<span class="token punctuation">)</span><span class="token comment">/* Probabilità prenda fuoco la casella vuota */</span>
                        forest<span class="token punctuation">[</span>i <span class="token operator">*</span> N <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">&lt;=</span>prob_generate_fire<span class="token operator">+</span>prob_generate_seed<span class="token punctuation">)</span><span class="token comment">/* Probabilità che nasca un nuovo albero */</span>
                        forest<span class="token punctuation">[</span>i <span class="token operator">*</span> N <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'i'</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
   
<span class="token punctuation">}</span>

<span class="token comment">//Setto array top da inviare</span>
<span class="token keyword">void</span> <span class="token function">edge_top_send_array</span><span class="token punctuation">(</span><span class="token keyword">char</span> from<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">char</span> to<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> N<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>N<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        to<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token comment">//Setto array bot da inviare</span>
<span class="token keyword">void</span> <span class="token function">edge_bot_send_array</span><span class="token punctuation">(</span><span class="token keyword">char</span> from<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">char</span> to<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> N<span class="token punctuation">,</span><span class="token keyword">int</span> split<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>N<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        to<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>from<span class="token punctuation">[</span><span class="token punctuation">(</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//Controlla se ci sono fuochi ai bordi</span>
<span class="token comment">// 3 entrambi, 2 bot, 1 top, 0 nulla</span>
<span class="token keyword">int</span> <span class="token function">if_send_pack</span><span class="token punctuation">(</span><span class="token keyword">char</span> forest<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> row<span class="token punctuation">,</span><span class="token keyword">int</span> col<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">int</span> top<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>bot<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>row<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>forest<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'*'</span><span class="token punctuation">)</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>row<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>forest<span class="token punctuation">[</span><span class="token punctuation">(</span>row<span class="token number">-1</span><span class="token punctuation">)</span> <span class="token operator">*</span> col <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'*'</span><span class="token punctuation">)</span> bot<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>top <span class="token operator">&amp;&amp;</span> bot<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>bot <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>top<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>top <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>bot<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//Funzione che applica il fuoco sulla foresta e ritorna se ci sono fuochi</span>
<span class="token comment">// 3 entrambi, 2 bot, 1 top, 0 nulla</span>
<span class="token keyword">int</span> <span class="token function">fire_run_return</span><span class="token punctuation">(</span><span class="token keyword">char</span> forest0<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">char</span> forest1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> row<span class="token punctuation">,</span><span class="token keyword">int</span> col<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">int</span> top<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>bot<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>row<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>col<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>forest0<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">case</span> <span class="token string">'T'</span><span class="token punctuation">:</span><span class="token comment">/*Se questo albero è stato bruciato da un vicino lo rimango tale altrimenti no*/</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'*'</span><span class="token punctuation">)</span>
                            <span class="token punctuation">;</span>
                        <span class="token keyword">else</span>
                            forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'T'</span><span class="token punctuation">;</span>
                            
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token keyword">case</span> <span class="token string">'*'</span><span class="token punctuation">:</span>                        
                        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> top<span class="token operator">++</span><span class="token punctuation">;</span>
                        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span>row<span class="token number">-1</span><span class="token punctuation">)</span> bot<span class="token operator">++</span><span class="token punctuation">;</span>
                        <span class="token comment">/* [x][y]*/</span>                      
                        <span class="token comment">/*[-1][-1] [-1][0] [-1][+1] [0][-1] [0][0] [0][+1] [+1][-1] [+1][0] [+1][+1]*/</span>
                        forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">;</span><span class="token comment">/*Spengo il fuoco che ha bruciato i dintorni*/</span>
                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> x <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">/*Brucio nei dintorni gli alberi*/</span>
                        <span class="token punctuation">{</span>
                            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> y <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span>
                            <span class="token punctuation">{</span>
                                <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&lt;</span>row<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token operator">&lt;</span>col<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                                    <span class="token keyword">if</span><span class="token punctuation">(</span>forest0<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> col <span class="token operator">+</span> <span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'T'</span><span class="token punctuation">)</span><span class="token comment">/*Gli alberi prendono fuoco*/</span>
                                        forest1<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> col <span class="token operator">+</span> <span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token string">'i'</span><span class="token punctuation">:</span>
                        forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'i'</span><span class="token punctuation">;</span><span class="token comment">/*La natura vince sugli umani che sono malvagi e un seed sopravvive sempre*/</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token string">'-'</span><span class="token punctuation">:</span>
                        forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">;</span><span class="token comment">/*Vuoto ero e vuoto rimango*/</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>top <span class="token operator">&amp;&amp;</span> bot<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>bot <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>top<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>top <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>bot<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">//Funzione che applica il fuoco sulla foresta e ritorna se ci sono fuochi</span>
<span class="token comment">// 3 entrambi, 2 bot, 1 top, 0 nulla</span>
<span class="token keyword">void</span> <span class="token function">fire_run_return_set</span><span class="token punctuation">(</span><span class="token keyword">char</span> forest0<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">char</span> forest1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> row<span class="token punctuation">,</span><span class="token keyword">int</span> col<span class="token punctuation">,</span><span class="token keyword">int</span> top_edge<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> bot_edge<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">*</span>top<span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">*</span>bot<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token operator">*</span>top<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>bot<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>row<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>col<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>forest0<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">case</span> <span class="token string">'T'</span><span class="token punctuation">:</span><span class="token comment">/*Se questo albero è stato bruciato da un vicino lo rimango tale altrimenti no*/</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'*'</span><span class="token punctuation">)</span>
                            <span class="token punctuation">;</span>
                        <span class="token keyword">else</span>
                            forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'T'</span><span class="token punctuation">;</span>
                            
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token keyword">case</span> <span class="token string">'*'</span><span class="token punctuation">:</span>          
                        <span class="token comment">/*Imposto l'array da ritornare*/</span>              
                        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span> top_edge<span class="token punctuation">[</span><span class="token operator">*</span>top<span class="token punctuation">]</span><span class="token operator">=</span>j<span class="token punctuation">;</span><span class="token operator">*</span>top<span class="token operator">=</span><span class="token operator">*</span>top<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span> 
                        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span>row<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">{</span> bot_edge<span class="token punctuation">[</span><span class="token operator">*</span>bot<span class="token punctuation">]</span><span class="token operator">=</span>j<span class="token punctuation">;</span><span class="token operator">*</span>bot<span class="token operator">=</span><span class="token operator">*</span>bot<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span> 

                        <span class="token comment">/* [x][y]*/</span>                      
                        <span class="token comment">/*[-1][-1] [-1][0] [-1][+1] [0][-1] [0][0] [0][+1] [+1][-1] [+1][0] [+1][+1]*/</span>
                        forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">;</span><span class="token comment">/*Spengo il fuoco che ha bruciato i dintorni*/</span>
                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> x <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">/*Brucio nei dintorni gli alberi*/</span>
                        <span class="token punctuation">{</span>
                            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> y <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span>
                            <span class="token punctuation">{</span>
                                <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&lt;</span>row<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token operator">&lt;</span>col<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                                    <span class="token keyword">if</span><span class="token punctuation">(</span>forest0<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> col <span class="token operator">+</span> <span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'T'</span><span class="token punctuation">)</span><span class="token comment">/*Gli alberi prendono fuoco*/</span>
                                        forest1<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> col <span class="token operator">+</span> <span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token string">'i'</span><span class="token punctuation">:</span>
                        forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'i'</span><span class="token punctuation">;</span><span class="token comment">/*La natura vince sugli umani che sono malvagi e un seed sopravvive sempre*/</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token string">'-'</span><span class="token punctuation">:</span>
                        forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">;</span><span class="token comment">/*Vuoto ero e vuoto rimango*/</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//Accendo il fuoco sul bordo superiore</span>
<span class="token keyword">void</span> <span class="token function">fire_run_top_edge_pointer</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> N_top<span class="token punctuation">,</span><span class="token keyword">char</span> to<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> N<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>N_top<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>x<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>x<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&lt;</span>N<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">[</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'T'</span><span class="token punctuation">)</span><span class="token comment">/*Gli alberi prendono fuoco*/</span>
                    to<span class="token punctuation">[</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//Accendo il fuoco sul bordo inferiore</span>
<span class="token keyword">void</span> <span class="token function">fire_run_bot_edge_pointer</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> N_bot<span class="token punctuation">,</span><span class="token keyword">char</span> to<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> N<span class="token punctuation">,</span><span class="token keyword">int</span> split<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>N_bot<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>x<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>x<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">+</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token punctuation">(</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">+</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&lt;</span>N<span class="token operator">*</span>split<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">[</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">+</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'T'</span><span class="token punctuation">)</span><span class="token comment">/*Gli alberi prendono fuoco*/</span>
                    to<span class="token punctuation">[</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">+</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/********************************************************************
STAMPA
*********************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">print_menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>


    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\033[0;32m░▒█▀▀▀░▄▀▀▄░█▀▀▄░█▀▀░█▀▀░▀█▀░░░░█▀▀░░▀░░█▀▀▄░█▀▀░░░▒█▀▀▀█░░▀░░█▀▄▀█░█░▒█░█░░█▀▀▄░▀█▀░░▀░░▄▀▀▄░█▀▀▄\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"░▒█▀▀░░█░░█░█▄▄▀░█▀▀░▀▀▄░░█░░▀▀░█▀░░░█▀░█▄▄▀░█▀▀░░░░▀▀▀▄▄░░█▀░█░▀░█░█░▒█░█░░█▄▄█░░█░░░█▀░█░░█░█░▒█\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"░▒█░░░░░▀▀░░▀░▀▀░▀▀▀░▀▀▀░░▀░░░░░▀░░░▀▀▀░▀░▀▀░▀▀▀░░░▒█▄▄▄█░▀▀▀░▀░░▒▀░░▀▀▀░▀▀░▀░░▀░░▀░░▀▀▀░░▀▀░░▀░░▀\033[0m\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\033[0;36m         _                     ___                \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|_ \\/   |_| _ _|_ _  _  . _     _/ . _  _  _   _ .\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|_)/    | || | |_(_)| | |(_)   /__ | /_ /_(_| |  |\033[0m\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">help_print</span><span class="token punctuation">(</span><span class="token keyword">int</span> N<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"+-----+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token number">-1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-----+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">help_print_split</span><span class="token punctuation">(</span><span class="token keyword">int</span> N<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\033[0;35m+-----+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token number">-1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>    
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"-----+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\033[0m\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//Stampo la foresta</span>
<span class="token keyword">void</span> <span class="token function">print_forest</span><span class="token punctuation">(</span><span class="token keyword">char</span> forest<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> N<span class="token punctuation">,</span><span class="token keyword">int</span> M<span class="token punctuation">,</span><span class="token keyword">int</span> style<span class="token punctuation">,</span><span class="token keyword">int</span> split<span class="token punctuation">,</span><span class="token keyword">int</span> plus_i<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">help_print</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>   
            <span class="token keyword">if</span><span class="token punctuation">(</span>style<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'T'</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  \033[0;32m%c\033[0m  "</span><span class="token punctuation">,</span> forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  \033[1;31m%c\033[0m  "</span><span class="token punctuation">,</span> forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'i'</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  \033[0;33m%c\033[0m  "</span><span class="token punctuation">,</span> forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  %c  "</span><span class="token punctuation">,</span> forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'T'</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"| 🌳  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"| 🔥  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'i'</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"| 🌱  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|  -  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>            
        <span class="token punctuation">}</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"|\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>style<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>plus_i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">(</span>split<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    plus_i<span class="token operator">--</span><span class="token punctuation">;</span>
                    <span class="token function">help_print_split</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token function">help_print</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>split<span class="token operator">==</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> i<span class="token operator">&lt;</span>N<span class="token number">-1</span><span class="token punctuation">)</span> <span class="token function">help_print_split</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token function">help_print</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>               
        <span class="token keyword">else</span>
            <span class="token function">help_print</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="prova-della-correttezza">Prova della correttezza</h2>
<p>Ad inizio programma, dopo che son state passate le variabili principali via linea di comando, il programma andrà a calcolare quanta porzione di array dovrà avere ogni processore <strong>worker</strong>, esso è definito da questa funzione:</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token comment">//Suddivisione dominio per righe</span>
<span class="token keyword">void</span> <span class="token function">split_domain</span><span class="token punctuation">(</span><span class="token keyword">int</span> num_p<span class="token punctuation">,</span><span class="token keyword">int</span> domain<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>split<span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">*</span>plus_i<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>num_p<span class="token operator">&gt;</span>domain<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span> <span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"N matrice non compatibile con numero processori\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">MPI_Abort</span><span class="token punctuation">(</span>MPI_COMM_WORLD<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">*</span>split <span class="token operator">=</span> domain<span class="token operator">/</span>num_p<span class="token punctuation">;</span>
    <span class="token operator">*</span>plus_i <span class="token operator">=</span>  domain<span class="token operator">%</span>num_p<span class="token punctuation">;</span><span class="token comment">//Numero di elementi che avranno un +1 sulla riga</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Dopo aver ottenuto il numero di righe da assegnare ad ogni processore, in modo indipendente il worker genera una porzione della foresta nel seguente modo:</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token comment">/*Popolo il bosco*/</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rank_split<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">&lt;=</span>prob_generate_tree<span class="token punctuation">)</span><span class="token comment">/* Probabilità che nasca un albero */</span>
                splitted_forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'T'</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                splitted_forest<span class="token punctuation">[</span>i <span class="token operator">*</span> M <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>Quel che abbiamo ottenuto è un array di alberi di questo tipo:</p>
<pre><code>Day 0
+-----+-----+-----+-----+-----+-----+-----+-----+
|  -  |  T  |  -  |  T  |  T  |  -  |  -  |  -  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  T  |  T  |  T  |  -  |  T  |  -  |  T  |  -  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  T  |  T  |  -  |  -  |  -  |  T  |  T  |  -  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  -  |  T  |  T  |  T  |  -  |  -  |  T  |  -  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  T  |  -  |  T  |  T  |  -  |  T  |  -  |  T  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  T  |  -  |  -  |  T  |  T  |  -  |  T  |  T  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  T  |  T  |  T  |  -  |  T  |  -  |  T  |  T  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  -  |  T  |  T  |  -  |  T  |  -  |  T  |  T  |
+-----+-----+-----+-----+-----+-----+-----+-----+
</code></pre>
<p>Successivamente, viene lanciata la funzione <code>fire_run_return_set()</code> che ha il compito di propagare il fuoco alle celle vicine, ma dato che questa foresta è ancora “intatta” cioè non ci sono fuochi, viene  lanciata la funzione <code>forest_run()</code>:</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token comment">//si accende il fuoco &amp; nasce un seed &amp; cresce un albero</span>
<span class="token keyword">void</span> <span class="token function">forest_run</span><span class="token punctuation">(</span><span class="token keyword">int</span> rank_split<span class="token punctuation">,</span><span class="token keyword">int</span> N<span class="token punctuation">,</span><span class="token keyword">char</span> forest<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> prob_generate_fire<span class="token punctuation">,</span><span class="token keyword">int</span> prob_generate_seed<span class="token punctuation">)</span><span class="token punctuation">{</span>
    
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rank_split<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>forest<span class="token punctuation">[</span>i <span class="token operator">*</span> N <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token string">'T'</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">&lt;=</span>prob_generate_fire<span class="token punctuation">)</span><span class="token comment">/* Probabilità che un albero prenda fuoco */</span>
                        forest<span class="token punctuation">[</span>i <span class="token operator">*</span> N <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">'i'</span><span class="token punctuation">:</span>
                    forest<span class="token punctuation">[</span>i <span class="token operator">*</span> N <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'T'</span><span class="token punctuation">;</span> <span class="token comment">/* L'albero cresce*/</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">'-'</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">&lt;=</span>prob_generate_fire<span class="token punctuation">)</span><span class="token comment">/* Probabilità prenda fuoco la casella vuota */</span>
                        forest<span class="token punctuation">[</span>i <span class="token operator">*</span> N <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">&lt;=</span>prob_generate_fire<span class="token operator">+</span>prob_generate_seed<span class="token punctuation">)</span><span class="token comment">/* Probabilità che nasca un nuovo albero */</span>
                        forest<span class="token punctuation">[</span>i <span class="token operator">*</span> N <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'i'</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre>
<p>Essa farà in modo che: in accordo con le probabilità <a href="#introduzione">assegnate</a> nascerà un seme d’albero, un seme diventa un albero, e uno spazio vuoto o un albero può prender fuoco. L’output ci genererà la seguente matrice:</p>
<pre><code>Day 1
+-----+-----+-----+-----+-----+-----+-----+-----+
|  -  |  T  |  -  |  T  |  T  |  -  |  -  |  -  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  T  |  T  |  T  |  i  |  T  |  -  |  T  |  -  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  T  |  T  |  -  |  -  |  *  |  T  |  T  |  -  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  -  |  T  |  T  |  T  |  -  |  -  |  T  |  -  |
+-----+-----+-----+-----+-----+-----+-----+-----+ 
|  T  |  -  |  T  |  T  |  -  |  T  |  -  |  T  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  T  |  -  |  -  |  T  |  T  |  *  |  T  |  T  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  T  |  T  |  T  |  -  |  T  |  -  |  T  |  T  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  -  |  T  |  T  |  -  |  T  |  -  |  T  |  T  |
+-----+-----+-----+-----+-----+-----+-----+-----+
</code></pre>
<p>Come è possibile notare sono nati dei fuochi, e un seme di albero.<br>
Al  prossimo ciclo di esecuzione il fuoco verrà propagato attraverso la funzione precedentemente citata <code>fire_run_return_set()</code>, inserendo il risultato in una nuova matrice:</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token comment">//Funzione che applica il fuoco sulla foresta e ritorna se ci sono fuochi</span>
<span class="token comment">// 3 entrambi, 2 bot, 1 top, 0 nulla</span>
<span class="token keyword">void</span> <span class="token function">fire_run_return_set</span><span class="token punctuation">(</span><span class="token keyword">char</span> forest0<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">char</span> forest1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> row<span class="token punctuation">,</span><span class="token keyword">int</span> col<span class="token punctuation">,</span><span class="token keyword">int</span> top_edge<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> bot_edge<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">*</span>top<span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">*</span>bot<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token operator">*</span>top<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>bot<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>row<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>col<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>forest0<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">case</span> <span class="token string">'T'</span><span class="token punctuation">:</span><span class="token comment">/*Se questo albero è stato bruciato da un vicino lo rimango tale altrimenti no*/</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'*'</span><span class="token punctuation">)</span>
                            <span class="token punctuation">;</span>
                        <span class="token keyword">else</span>
                            forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'T'</span><span class="token punctuation">;</span>
                            
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token keyword">case</span> <span class="token string">'*'</span><span class="token punctuation">:</span>          
                        <span class="token comment">/*Imposto l'array da ritornare*/</span>              
                        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span> top_edge<span class="token punctuation">[</span><span class="token operator">*</span>top<span class="token punctuation">]</span><span class="token operator">=</span>j<span class="token punctuation">;</span><span class="token operator">*</span>top<span class="token operator">=</span><span class="token operator">*</span>top<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span> 
                        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span>row<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">{</span> bot_edge<span class="token punctuation">[</span><span class="token operator">*</span>bot<span class="token punctuation">]</span><span class="token operator">=</span>j<span class="token punctuation">;</span><span class="token operator">*</span>bot<span class="token operator">=</span><span class="token operator">*</span>bot<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span> 

                        <span class="token comment">/* [x][y]*/</span>                      
                        <span class="token comment">/*[-1][-1] [-1][0] [-1][+1] [0][-1] [0][0] [0][+1] [+1][-1] [+1][0] [+1][+1]*/</span>
                        forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">;</span><span class="token comment">/*Spengo il fuoco che ha bruciato i dintorni*/</span>
                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> x <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span><span class="token comment">/*Brucio nei dintorni gli alberi*/</span>
                        <span class="token punctuation">{</span>
                            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> y <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span>
                            <span class="token punctuation">{</span>
                                <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&lt;</span>row<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token operator">&lt;</span>col<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
                                    <span class="token keyword">if</span><span class="token punctuation">(</span>forest0<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> col <span class="token operator">+</span> <span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'T'</span><span class="token punctuation">)</span><span class="token comment">/*Gli alberi prendono fuoco*/</span>
                                        forest1<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> col <span class="token operator">+</span> <span class="token punctuation">(</span>j<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token string">'i'</span><span class="token punctuation">:</span>
                        forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'i'</span><span class="token punctuation">;</span><span class="token comment">/*La natura vince sugli umani che sono malvagi e un seed sopravvive sempre*/</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token keyword">case</span> <span class="token string">'-'</span><span class="token punctuation">:</span>
                        forest1<span class="token punctuation">[</span>i <span class="token operator">*</span> col <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'-'</span><span class="token punctuation">;</span><span class="token comment">/*Vuoto ero e vuoto rimango*/</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>a questo punto viene lanciata <code>forest_run()</code>, e ciò che otterremo sarà la seguente matrice:</p>
<pre><code>Day 2
+-----+-----+-----+-----+-----+-----+-----+-----+
|  -  |  T  |  -  |  T  |  T  |  *  |  -  |  -  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  *  |  T  |  T  |  -  |  *  |  -  |  T  |  -  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  T  |  T  |  -  |  -  |  -  |  *  |  T  |  -  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  -  |  T  |  T  |  *  |  *  |  -  |  T  |  -  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  T  |  -  |  T  |  T  |  -  |  *  |  i  |  T  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  T  |  -  |  -  |  T  |  *  |  -  |  *  |  T  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  T  |  T  |  T  |  *  |  *  |  i  |  *  |  T  |
+-----+-----+-----+-----+-----+-----+-----+-----+
|  -  |  T  |  *  |  -  |  T  |  -  |  T  |  T  |
+-----+-----+-----+-----+-----+-----+-----+-----+
</code></pre>
<p>Essa contiene sia il fuoco propagato, che la generazione dei nuovi elementi.<br>
Ricapitolando in successione l’output ottenuto sarà il seguente(Questa volta con una grafica migliore):<br>
<img src="https://i.imgur.com/dWMkdMp.png" alt=""><br>
Dovendo favorire il calcolo su più processori la soluzione proposta è eseguita su più processori che comunicano in modo intelligente.<br>
2 o più processori durante la loro esecuzione condividono delle <em>“criticità”</em> dovute al fatto che per completare la loro simulazione hanno bisogno di comunicare con i bordi superiori ed inferiori.<br>
A tal proposito durante l’esecuzione della funzione <code>fire_run_return_set()</code> vengono segnati quanti elementi sono presenti al bordo superiore e al bordo inferiore, definiti con il nome di <code>top</code> e <code>bot</code>, ed in contemporanea vengono salvati in un array l’indice di ogni cella che contiene fuoco.<br>
Sfruttando i dati precedentemente ottenuti, quel che si conosce adesso è se sul bordo ci sono fuochi o meno, e se ci sono a quale indice alloggiano, e si comunica tra processori in modo intelligente lanciando <em>send</em> <em>dinamiche</em></p>
<pre class=" language-c"><code class="prism  language-c"><span class="token function">MPI_Isend</span><span class="token punctuation">(</span>top_send<span class="token punctuation">,</span> top<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> myrank<span class="token number">-1</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>request_send1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">MPI_Isend</span><span class="token punctuation">(</span>bot_send<span class="token punctuation">,</span> bot<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> myrank<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> MPI_COMM_WORLD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>request_send2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Il processore che riceverà i dati andrà a controllare se ha ricevuto elementi nel seguente modo:</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token function">MPI_Get_count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>status2<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>count1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>count1<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token function">fire_run_bot_edge_pointer</span><span class="token punctuation">(</span>bot_recv<span class="token punctuation">,</span>count1<span class="token punctuation">,</span>temp_forest<span class="token punctuation">,</span>M<span class="token punctuation">,</span>rank_split<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">MPI_Get_count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>status4<span class="token punctuation">,</span> MPI_INT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>count2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>count2<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token function">fire_run_top_edge_pointer</span><span class="token punctuation">(</span>top_recv<span class="token punctuation">,</span>count2<span class="token punctuation">,</span>temp_forest<span class="token punctuation">,</span>M<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Se ha ricevuto qualcosa allora semplicemente farà la propagazione del fuoco ai bordi nel seguente modo:</p>
<pre class=" language-c"><code class="prism  language-c"><span class="token comment">//Accendo il fuoco sul bordo superiore</span>
<span class="token keyword">void</span> <span class="token function">fire_run_top_edge_pointer</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> N_top<span class="token punctuation">,</span><span class="token keyword">char</span> to<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> N<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>N_top<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>x<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>x<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&lt;</span>N<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">[</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'T'</span><span class="token punctuation">)</span><span class="token comment">/*Gli alberi prendono fuoco*/</span>
                    to<span class="token punctuation">[</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//Accendo il fuoco sul bordo inferiore</span>
<span class="token keyword">void</span> <span class="token function">fire_run_bot_edge_pointer</span><span class="token punctuation">(</span><span class="token keyword">int</span> from<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> N_bot<span class="token punctuation">,</span><span class="token keyword">char</span> to<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> N<span class="token punctuation">,</span><span class="token keyword">int</span> split<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>N_bot<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>x<span class="token operator">&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>x<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">+</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token punctuation">(</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">+</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&lt;</span>N<span class="token operator">*</span>split<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>to<span class="token punctuation">[</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">+</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'T'</span><span class="token punctuation">)</span><span class="token comment">/*Gli alberi prendono fuoco*/</span>
                    to<span class="token punctuation">[</span>N<span class="token operator">*</span><span class="token punctuation">(</span>split<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">+</span>from<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Il tutto è iterato un numero di volte finito. Al termine di esso viene stampato il tempo impiegato dall’algoritmo.<br>
Fine.</p>
<h2 id="benchmarks">Benchmarks</h2>
<p>I benchmarks sono stati lanciati su <strong>Google Cloud Platform</strong>, utilizzando 6 macchine <strong>e2-standard-4</strong> aventi ognuno 4 vCPUs.<br>
Con un totale di 24 vCPUs i risultati ottenuti sono:</p>
<h4 id="strong-scalability">Strong scalability</h4>
<p>L’algoritmo è stato eseguito su una matrice 10.000x10.000</p>

<table>
<thead>
<tr>
<th>vCPUs</th>
<th>Tempo</th>
<th>Speed-up</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>32.928257</td>
<td>-</td>
</tr>
<tr>
<td>2</td>
<td>16.311782</td>
<td>2,019</td>
</tr>
<tr>
<td>3</td>
<td>15.983904</td>
<td>2,06</td>
</tr>
<tr>
<td>4</td>
<td>12.809180</td>
<td>2,571</td>
</tr>
<tr>
<td>5</td>
<td>9.636696</td>
<td>3,417</td>
</tr>
<tr>
<td>6</td>
<td>8.069048</td>
<td>4,081</td>
</tr>
<tr>
<td>7</td>
<td>6.912726</td>
<td>4,763</td>
</tr>
<tr>
<td>8</td>
<td>6.072358</td>
<td>5,423</td>
</tr>
<tr>
<td>9</td>
<td>5.734646</td>
<td>5,742</td>
</tr>
<tr>
<td>10</td>
<td>5.303405</td>
<td>6,209</td>
</tr>
<tr>
<td>11</td>
<td>4.695636</td>
<td>7,013</td>
</tr>
<tr>
<td>12</td>
<td>4.288977</td>
<td>7,677</td>
</tr>
<tr>
<td>13</td>
<td>3.737966</td>
<td>8,809</td>
</tr>
<tr>
<td>14</td>
<td>3.496114</td>
<td>9,419</td>
</tr>
<tr>
<td>15</td>
<td>3.240169</td>
<td>10,16</td>
</tr>
<tr>
<td>16</td>
<td>3.182754</td>
<td>10,35</td>
</tr>
<tr>
<td>17</td>
<td>2.875140</td>
<td>11,45</td>
</tr>
<tr>
<td>18</td>
<td>2.734069</td>
<td>12,04</td>
</tr>
<tr>
<td>19</td>
<td>2.623592</td>
<td>12,55</td>
</tr>
<tr>
<td>20</td>
<td>2.527962</td>
<td>13,03</td>
</tr>
<tr>
<td>21</td>
<td>2.372710</td>
<td>13,88</td>
</tr>
<tr>
<td>22</td>
<td>2.235581</td>
<td>14,73</td>
</tr>
<tr>
<td>23</td>
<td>2.173712</td>
<td>15,15</td>
</tr>
<tr>
<td>24</td>
<td>2.057124</td>
<td>16,00694</td>
</tr>
</tbody>
</table><p>Come è possibile notare a 24 vCPU si ottiene uno Speed-up di ben 16, sebbene il risultato non è super notevole rimane un ottimo risultato.</p>
<h4 id="weak-scalability">Weak scalability</h4>
<p>L’algoritmo è stato eseguito su una matrice <strong>np</strong>x10.000.000</p>

<table>
<thead>
<tr>
<th>vCPUs</th>
<th>Tempo</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2.868079</td>
</tr>
<tr>
<td>2</td>
<td>3.003850</td>
</tr>
<tr>
<td>3</td>
<td>4.720806</td>
</tr>
<tr>
<td>4</td>
<td>4.882781</td>
</tr>
<tr>
<td>5</td>
<td>4.995334</td>
</tr>
<tr>
<td>6</td>
<td>4.997530</td>
</tr>
<tr>
<td>7</td>
<td>5.064155</td>
</tr>
<tr>
<td>8</td>
<td>5.067452</td>
</tr>
<tr>
<td>9</td>
<td>5.083282</td>
</tr>
<tr>
<td>10</td>
<td>5.059520</td>
</tr>
<tr>
<td>11</td>
<td>5.104069</td>
</tr>
<tr>
<td>12</td>
<td>5.449976</td>
</tr>
<tr>
<td>13</td>
<td>5.156495</td>
</tr>
<tr>
<td>14</td>
<td>5.126553</td>
</tr>
<tr>
<td>15</td>
<td>5.201446</td>
</tr>
<tr>
<td>16</td>
<td>5.699584</td>
</tr>
<tr>
<td>17</td>
<td>5.142877</td>
</tr>
<tr>
<td>18</td>
<td>5.490366</td>
</tr>
<tr>
<td>19</td>
<td>5.171884</td>
</tr>
<tr>
<td>20</td>
<td>5.138652</td>
</tr>
<tr>
<td>21</td>
<td>5.379677</td>
</tr>
<tr>
<td>22</td>
<td>5.127093</td>
</tr>
<tr>
<td>23</td>
<td>5.197929</td>
</tr>
<tr>
<td>24</td>
<td>5.142240</td>
</tr>
</tbody>
</table><p>E’ stato possibile dimostrare che dando lo stesso numero di elementi a n processori il tempo di esecuzione è pressoché identico.</p>
</div>
</body>

</html>
